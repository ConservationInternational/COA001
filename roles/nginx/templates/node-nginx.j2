server {
  listen 80;
  return 301 https://{{ project_url }}$request_uri;
}

server {

  listen 443;
  ssl on;

  server_name {{ project_url }} *.{{ project_url }};

  ssl_certificate /etc/nginx/ssl/server.crt;
  ssl_certificate_key /etc/nginx/ssl/server.key;

  root /var/www/frontend/app;

  location / {
    try_files $uri$args $uri /index.html;
  }

  location = /favicon.ico { access_log off; log_not_found off; }
  location = /robots.txt { access_log off; log_not_found off; }
  location = /apple-touch-icon.png { access_log off; log_not_found off; }
  location = /apple-touch-icon-precomposed.png { access_log off; log_not_found off; }
  # deny access to all .invisible files
  location ~ /\. { deny  all; access_log off; log_not_found off; }
  location /api {
    proxy_pass          http://127.0.0.1:3000;
    proxy_buffering off;
    proxy_redirect off;
    proxy_set_header        Host              $http_host;
    proxy_set_header        X_FORWARDED_PROTO https;
    proxy_set_header        X-Real-IP         $remote_addr;
    proxy_set_header        X-Forwarded-For   $proxy_add_x_forwarded_for;
    proxy_set_header X-NginX-Proxy true;
    expires 0;
  }
  location ~ ^/(images/|img/|fonts/|javascript/|js/|css/|stylesheets/|flash/|media/|static/|robots.txt|humans.txt) {
    access_log off;
    expires 0;
  }
  error_page   500 502 503 504 /50x.html;
}
